"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4162],{16339:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"developer-guide/animations-and-transitions","title":"Animations and Transitions","description":"deck.gl provides several built-in animation/transition features.","source":"@site/../docs/developer-guide/animations-and-transitions.md","sourceDirName":"developer-guide","slug":"/developer-guide/animations-and-transitions","permalink":"/docs/developer-guide/animations-and-transitions","draft":false,"unlisted":false,"editUrl":"https://github.com/visgl/deck.gl/tree/master/website/../docs/developer-guide/animations-and-transitions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Views and Projections","permalink":"/docs/developer-guide/views"},"next":{"title":"Loading Data","permalink":"/docs/developer-guide/loading-data"}}');var r=t(74848),a=t(28453),s=t(11470),o=t(19365);const l={},c="Animations and Transitions",d={},h=[{value:"Camera Transitions",id:"camera-transitions",level:2},{value:"Camera Transition Examples",id:"camera-transition-examples",level:3},{value:"Remarks",id:"remarks",level:3},{value:"Layer Prop Transitions",id:"layer-prop-transitions",level:2},{value:"Attribute Backfilling",id:"attribute-backfilling",level:3},{value:"Limitations",id:"limitations",level:3},{value:"Custom Animations",id:"custom-animations",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"animations-and-transitions",children:"Animations and Transitions"})}),"\n",(0,r.jsx)(n.p,{children:"deck.gl provides several built-in animation/transition features."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"#camera-transitions",children:"Camera Transitions"})})," - the camera can move smoothly from the current view state to the new view state."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"#layer-prop-transitions",children:"Layer Prop Transitions"})})," - when a layer prop is updated, it may animate from the old value to the new value."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Advanced motion effects can also be implemented using deck.gl in conjunction with other animation libraries, see the ",(0,r.jsx)(n.a,{href:"#custom-animations",children:"custom animations"})," section."]}),"\n",(0,r.jsx)(n.h2,{id:"camera-transitions",children:"Camera Transitions"}),"\n",(0,r.jsxs)(n.p,{children:["Camera transitions provide smooth and visually appealing transitions when ",(0,r.jsx)(n.code,{children:"viewState"})," change from one state to the other."]}),"\n",(0,r.jsxs)(n.p,{children:["Transitions are performed when setting ",(0,r.jsx)(n.code,{children:"Deck"}),"'s ",(0,r.jsx)(n.code,{children:"viewState"})," or ",(0,r.jsx)(n.code,{children:"initialViewState"})," prop to a new value with the following additional fields:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"transitionInterpolator"})," (object, optional, default: ",(0,r.jsx)(n.code,{children:"LinearInterpolator"}),") - An interpolator object that defines the transition behavior between two view states. The choices are:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/api-reference/core/linear-interpolator",children:"LinearInterpolator"})," - a generic interpolator that works with all view types. This is the default."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/api-reference/core/fly-to-interpolator",children:"FlyToInterpolator"}),' - a "fly to" style camera transition for geospatial views. This is pretty useful when the camera center changes by long distance.']}),"\n",(0,r.jsxs)(n.li,{children:["Implement a custom interpolator. See ",(0,r.jsx)(n.a,{href:"/docs/api-reference/core/transition-interpolator",children:"TransitionInterpolator"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"transitionDuration"})," (number | string, optional, default: 0) - Transition duration in milliseconds, default value 0, implies no transition.\nWhen using ",(0,r.jsx)(n.code,{children:"FlyToInterpolator"}),", it can also be set to ",(0,r.jsx)(n.code,{children:"'auto'"})," where actual duration is calculated based on the distance between the start and end states, and the ",(0,r.jsx)(n.code,{children:"speed"})," option."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"transitionEasing"})," (Function, optional, default: ",(0,r.jsx)(n.code,{children:"t => t"}),') - Easing function that can be used to achieve effects like "Ease-In-Cubic", "Ease-Out-Cubic", etc. Default value performs Linear easing. (',(0,r.jsx)(n.a,{href:"http://easings.net",children:"list of sample easing functions"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"transitionInterruption"})," (number, optional, default: ",(0,r.jsx)(n.code,{children:"TRANSITION_EVENTS.BREAK"}),") - This field controls how to process a new view state change that occurs while performing an existing transition. This field has no impact once transition is complete. Here is the list of all possible values with resulting behavior."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.code,{children:"TRANSITION_EVENTS"})}),(0,r.jsx)(n.th,{children:"Result"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"BREAK"})}),(0,r.jsx)(n.td,{children:"Current transition will stop at the current state and next view state update is processed."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SNAP_TO_END"})}),(0,r.jsx)(n.td,{children:"Current transition will skip remaining transition steps and view state is updated to final value, transition is stopped and next view state update is processed."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IGNORE"})}),(0,r.jsx)(n.td,{children:"Any view state update is ignored until current transition is complete, this also includes view state changes due to user interaction."})]})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"onTransitionStart"})," (Functional, optional) - Callback fires when requested transition starts."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"onTransitionInterrupt"})," (Functional, optional) - Callback fires when transition is interrupted."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"onTransitionEnd"})," (Functional, optional) - Callback fires when transition ends."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"camera-transition-examples",children:"Camera Transition Examples"}),"\n",(0,r.jsxs)(n.p,{children:["This example provides ",(0,r.jsx)(n.code,{children:"flyTo"})," style transition to move camera from current location to the requested city."]}),"\n","\n",(0,r.jsxs)(s.A,{groupId:"language",children:[(0,r.jsx)(o.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import {Deck, FlyToInterpolator} from '@deck.gl/core';\n\nconst CITIES = {\n  SF: {\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 10\n  },\n  NYC: {\n    longitude: -74.0,\n    latitude: 40.7,\n    zoom: 10\n  }\n}\n\nconst deckInstance = new Deck({\n  initialViewState: CITIES.SF,\n  controller: true\n});\n\nfor (const button of document.querySelectorAll('button')) {\n  button.onclick = () => flyToCity(button.id);\n}\n\nfunction flyToCity(name) {\n  deckInstance.setProps({\n    initialViewState: {\n      ...CITIES[name],\n      transitionInterpolator: new FlyToInterpolator({speed: 2}),\n      transitionDuration: 'auto'\n    }\n  })\n}\n"})})}),(0,r.jsx)(o.A,{value:"ts",label:"TypeScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {Deck, MapViewState, FlyToInterpolator} from '@deck.gl/core';\n\nconst CITIES: {[name: string]: MapViewState} = {\n  SF: {\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 10\n  },\n  NYC: {\n    longitude: -74.0,\n    latitude: 40.7,\n    zoom: 10\n  }\n}\n\nconst deckInstance = new Deck({\n  initialViewState: CITIES.SF,\n  controller: true\n});\n\nfor (const button of document.querySelectorAll('button')) {\n  (button as HTMLButtonElement).onclick = () => flyToCity(button.id);\n}\n\nfunction flyToCity(name: string) {\n  deckInstance.setProps({\n    initialViewState: {\n      ...CITIES[name],\n      transitionInterpolator: new FlyToInterpolator({speed: 2}),\n      transitionDuration: 'auto'\n    }\n  })\n}\n"})})}),(0,r.jsx)(o.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React, {useState, useCallback} from 'react';\nimport {DeckGL} from '@deck.gl/react';\nimport {MapViewState, FlyToInterpolator} from '@deck.gl/core';\n\nconst CITIES: {[name: string]: MapViewState} = {\n  SF: {\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 10\n  },\n  NYC: {\n    longitude: -74.0,\n    latitude: 40.7,\n    zoom: 10\n  }\n}\n\nfunction App() {\n  const [initialViewState, setInitialViewState] = useState<MapViewState>(CITIES.SF);\n\n  const flyToCity = useCallback(evt => {\n    setInitialViewState({\n      ...CITIES[evt.target.id],\n      transitionInterpolator: new FlyToInterpolator({speed: 2}),\n      transitionDuration: 'auto'\n    });\n  }, [])\n\n  return <>\n    <DeckGL\n      initialViewState={initialViewState}\n      controller\n    />;\n    {Object.keys(CITIES).map(name => <button id={name} onClick={flyToCity}>{name}</button>)}\n  </>;\n}\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["This example continuously rotates the camera along the Z (vertical) axis until user interrupts the rotation by dragging. It uses ",(0,r.jsx)(n.code,{children:"LinearInterpolator"})," and restricts transitions to ",(0,r.jsx)(n.code,{children:"bearing"}),". Continuous transitions are achieved by triggering new transitions upon the ",(0,r.jsx)(n.code,{children:"onTransitionEnd"})," callback."]}),"\n",(0,r.jsxs)(s.A,{groupId:"language",children:[(0,r.jsx)(o.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import {Deck, LinearInterpolator} from '@deck.gl/core';\n\nlet initialViewState = {\n  longitude: -122.4,\n  latitude: 37.8,\n  zoom: 12\n};\n\nconst deckInstance = new Deck({\n  initialViewState,\n  controller: true,\n  onLoad: rotateCamera\n});\n\nfunction rotateCamera() {\n  initialViewState = {\n    ...initialViewState,\n    bearing: initialViewState.bearing + 120,\n    transitionDuration: 1000,\n    transitionInterpolator: new LinearInterpolator(['bearing']),\n    onTransitionEnd: rotateCamera\n  };\n  deckInstance.setProps({initialViewState});\n}\n"})})}),(0,r.jsx)(o.A,{value:"ts",label:"TypeScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {Deck, LinearInterpolator, MapViewState} from '@deck.gl/core';\n\nlet initialViewState: MapViewState = {\n  longitude: -122.4,\n  latitude: 37.8,\n  zoom: 12\n};\n\nconst deckInstance = new Deck({\n  initialViewState,\n  controller: true,\n  onLoad: rotateCamera\n});\n\nfunction rotateCamera(): void {\n  initialViewState = {\n    ...initialViewState,\n    bearing: initialViewState.bearing + 120,\n    transitionDuration: 1000,\n    transitionInterpolator: new LinearInterpolator(['bearing']),\n    onTransitionEnd: rotateCamera\n  };\n  deckInstance.setProps({initialViewState});\n}\n"})})}),(0,r.jsx)(o.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React, {useState, useCallback} from 'react';\nimport {DeckGL} from '@deck.gl/react';\nimport {LinearInterpolator, MapViewState} from '@deck.gl/core';\n\nfunction App() {\n  const [initialViewState, setInitialViewState] = useState<MapViewState>({\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 12\n  });\n\n  const rotateCamera = useCallback(() => {\n    setInitialViewState(viewState => ({\n      ...viewState,\n      bearing: viewState.bearing + 120,\n      transitionDuration: 1000,\n      transitionInterpolator: new LinearInterpolator(['bearing']),\n      onTransitionEnd: rotateCamera\n    }));\n  }, []);\n\n  return <DeckGL\n    initialViewState={initialViewState}\n    controller\n    onLoad={rotateCamera}\n  />;\n}\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"remarks",children:"Remarks"}),"\n",(0,r.jsx)(n.p,{children:'Deck\'s view state transition model is "set and forget": the values of the following props at the start of a transition carry through the entire duration of the transition:'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transitionDuration"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transitionInterpolator"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transitionEasing"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"transitionInterruption"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The default transition behavior can always be intercepted and overwritten in the handler for ",(0,r.jsx)(n.code,{children:"onViewStateChange"}),". However, if a transition is in progress, the properties that are being transitioned (e.g. longitude and latitude) should not be manipulated, otherwise the change will be interpreted as an interruption of the transition."]}),"\n",(0,r.jsx)(n.h2,{id:"layer-prop-transitions",children:"Layer Prop Transitions"}),"\n",(0,r.jsxs)(n.p,{children:["Layer properties may smoothly transition from one value to the next if a ",(0,r.jsx)(n.a,{href:"/docs/api-reference/core/layer#transitions",children:"transitions"})," prop is configured. There are two categories of transition-enabled props, for each enabling transition has different implications regarding performance and complexity."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uniform prop (usually of type ",(0,r.jsx)(n.code,{children:"number"})," or ",(0,r.jsx)(n.code,{children:"number[]"}),") transition is performed on the CPU. It only recomputes one single numeric value per update, and imposes virtually no cost on top of redrawing on each animation frame."]}),"\n",(0,r.jsxs)(n.li,{children:["Attribute prop (usually named ",(0,r.jsx)(n.code,{children:"get*"}),") transition is performed on the GPU. Since it recomputes values for ",(0,r.jsx)(n.code,{children:"attribute_size * data_length"})," numbers, the ammount of data being updated per frame can be quite large for a big dataset. For example, animating the position of 1M point cloud involves 3M float64 or 6M float32 numbers. Performing the computation on the GPU means that they can be updated efficiently in parallel and without leaving the GPU memory. However, when such a transition is first triggered, some of the preparation is done on the CPU (specifically the ",(0,r.jsx)(n.code,{children:"enter"})," callback), and it could potentially be expensive. See more discussions below."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To enable layer prop transitions, set the layer's ",(0,r.jsx)(n.code,{children:"transitions"}),' prop to an object that defines animation parameters by using the prop names as keys. The following example has the columns "grow" from the ground when data is loaded:']}),"\n",(0,r.jsxs)(s.A,{groupId:"language",children:[(0,r.jsx)(o.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import {Deck} from '@deck.gl/core';\nimport {HexagonLayer} from '@deck.gl/aggregation-layers';\n\nconst deckInstance = new Deck({\n  // ...\n  layer: getLayers(null)\n});\n\nconst resp = await fetch('/path/to/data.json');\nconst data = await resp.json();\ndeckInstance.setProps({\n  layer: getLayers(data)\n});\n\nfunction getLayers(data) {\n  return [\n    new HexagonLayer({\n      id: '3d-heatmap',\n      data,\n      getPosition: d => [d.longitude, d.latitude],\n      getElevationWeight: d => d.count,\n      extruded: true,\n      elevationScale: data && data.length ? 50 : 0,\n      transitions: {\n        elevationScale: 3000\n      }\n    })\n  ];\n}\n"})})}),(0,r.jsx)(o.A,{value:"ts",label:"TypeScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {Deck} from '@deck.gl/core';\nimport {HexagonLayer} from '@deck.gl/aggregation-layers';\n\ntype DataType = {\n  longitude: number;\n  latitude: number;\n  count: number;\n};\n\nconst deckInstance = new Deck({\n  // ...\n  layer: getLayers(null)\n});\n\nconst resp = await fetch('/path/to/data.json');\nconst data = await resp.json() as DataType[];\ndeckInstance.setProps({\n  layer: getLayers(data)\n});\n\nfunction getLayers(data: DataType[] | null) {\n  return [\n    new HexagonLayer<DataType>({\n      id: '3d-heatmap',\n      data,\n      getPosition: (d: DataType) => [d.longitude, d.latitude],\n      getElevationWeight: (d: DataType) => d.count,\n      extruded: true,\n      elevationScale: data && data.length ? 50 : 0,\n      transitions: {\n        elevationScale: 3000\n      }\n    })\n  ];\n}\n"})})}),(0,r.jsx)(o.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React, {useEffect, useState} from 'react';\nimport {DeckGL} from '@deck.gl/react';\nimport {HexagonLayer} from '@deck.gl/aggregation-layers';\n\ntype DataType = {\n  longitude: number;\n  latitude: number;\n  count: number;\n};\n\nfunction App() {\n  const [data, setData] = useState<DataType[] | null>(null);\n\n  useEffect(() => {\n    (async () => {\n      const resp = await fetch('/path/to/data.json');\n      const data = await resp.json() as DataType[];\n      setData(data);\n    })();\n  }, []);\n\n  const layers = [\n    new HexagonLayer<DataType>({\n      id: '3d-heatmap',\n      data,\n      getPosition: (d: DataType) => [d.longitude, d.latitude],\n      getElevationWeight: (d: DataType) => d.count,\n      extruded: true,\n      elevationScale: data && data.length ? 50 : 0,\n      transitions: {\n        elevationScale: 3000\n      }\n    })\n  ];\n\n  return <DeckGL\n    // ...\n    layers={layers}\n  />;\n}\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.code,{children:"transitions"})," object, each prop name is mapped to a number or an object that is the transition setting. As a shorthand, if a prop name maps to a number, then the number is assigned to the ",(0,r.jsx)(n.code,{children:"duration"})," parameter with an ",(0,r.jsx)(n.code,{children:"interpolation"})," type transition. If an object is supplied, it may contain the following fields:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"type"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'interpolation'"})}),(0,r.jsxs)(n.td,{children:["Type of the transition, currently supports ",(0,r.jsx)(n.code,{children:"'interpolation'"})," and ",(0,r.jsx)(n.code,{children:"'spring'"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enter"})}),(0,r.jsx)(n.td,{children:"Function"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"value => value"})}),(0,r.jsx)(n.td,{children:'Callback to get the value that the entering vertices are transitioning from. See "attribute backfilling" below'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"onStart"})}),(0,r.jsx)(n.td,{children:"Function"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsx)(n.td,{children:"Callback when the transition is started"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"onEnd"})}),(0,r.jsx)(n.td,{children:"Function"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsx)(n.td,{children:"Callback when the transition is done"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"onInterrupt"})}),(0,r.jsx)(n.td,{children:"Function"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsx)(n.td,{children:"Callback when the transition is interrupted"})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Additional fields for ",(0,r.jsx)(n.code,{children:"type: 'interpolation'"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"duration"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Number"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0"})}),(0,r.jsx)(n.td,{children:"Duration of the transition animation, in milliseconds"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"easing"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"(t: number) => number"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"t => t"})}),(0,r.jsxs)(n.td,{children:["Easing function that maps a value from [0, 1] to [0, 1], see ",(0,r.jsx)(n.a,{href:"http://easings.net/",children:"http://easings.net/"})]})]})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Additional fields for ",(0,r.jsx)(n.code,{children:"type: 'spring'"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"stiffness"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Number"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.05"})}),(0,r.jsx)(n.td,{children:'"Tension" factor for the spring'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"damping"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Number"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.5"})}),(0,r.jsx)(n.td,{children:'"Friction" factor that counteracts the spring\'s acceleration'})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"attribute-backfilling",children:"Attribute Backfilling"}),"\n",(0,r.jsxs)(n.p,{children:["Consider the following setup, a ",(0,r.jsx)(n.code,{children:"ScatterplotLayer"})," with ",(0,r.jsx)(n.code,{children:"transitions"})," enabled for positions and fill colors:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {ScatterplotLayer} from '@deck.gl/layers';\nimport type {Color} from '@deck.gl/core';\n\nnew ScatterplotLayer({\n  // ...\n  transitions: {\n    getPosition: {\n      type: 'spring',\n      damping: 0.2\n    },\n    getFillColor: {\n      duration: 600,\n      easing: (x: number) => -(Math.cos(Math.PI * x) - 1) / 2, // ease-in-out-sine\n      entry: ([r, g, b]: Color) => [r, g, b, 0]\n    }\n  }\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"When the layer's data updates from 3 elements to 4 elements, positions and colors also changed:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Object index"}),(0,r.jsxs)(n.th,{children:["Old ",(0,r.jsx)(n.code,{children:"getPosition"})," result"]}),(0,r.jsxs)(n.th,{children:["New ",(0,r.jsx)(n.code,{children:"getPosition"})," result"]}),(0,r.jsxs)(n.th,{children:["Old ",(0,r.jsx)(n.code,{children:"getFillColor"})," result"]}),(0,r.jsxs)(n.th,{children:["New ",(0,r.jsx)(n.code,{children:"getFillColor"})," result"]})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"0"}),(0,r.jsx)(n.td,{children:"[0, 0, 0]"}),(0,r.jsx)(n.td,{children:"[0, 3, 0]"}),(0,r.jsx)(n.td,{children:"[255, 0, 0, 255]"}),(0,r.jsx)(n.td,{children:"[255, 255, 0, 255]"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"1"}),(0,r.jsx)(n.td,{children:"[1, 0, 0]"}),(0,r.jsx)(n.td,{children:"[0, 0, 0]"}),(0,r.jsx)(n.td,{children:"[0, 255, 0, 255]"}),(0,r.jsx)(n.td,{children:"[255, 0, 0, 255]"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:"[2, 0, 0]"}),(0,r.jsx)(n.td,{children:"[1, 0, 0]"}),(0,r.jsx)(n.td,{children:"[0, 0, 255, 255]"}),(0,r.jsx)(n.td,{children:"[0, 255, 0, 255]"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"[2, 0, 0]"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"[0, 0, 255, 255]"})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"For index 0-2, transitions are performed from the old values to the new values at the same index."}),"\n",(0,r.jsxs)(n.li,{children:["Because the new data is larger, ",(0,r.jsx)(n.code,{children:"enter"}),' callback is called at index 3 to backfill the position and color to transition from. The first argument is the "to" value. For position, the default ',(0,r.jsx)(n.code,{children:"enter"})," returns ",(0,r.jsx)(n.code,{children:"[2, 0, 0]"})," (same value), which will look like the new circle just appeared in place. For color, the user-supplied ",(0,r.jsx)(n.code,{children:"enter"})," returns ",(0,r.jsx)(n.code,{children:"[0, 0, 255, 0]"})," (same RGB and alpha=0), which will look like the new circle faded in."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["When working with variable-length geometries, such as ",(0,r.jsx)(n.code,{children:"PathLayer"})," and ",(0,r.jsx)(n.code,{children:"PolygonLayer"}),", transitions are handled per geometry (path or polygon). For each geometry, transitions are performed between the old and new values at the same vertex index. If the new path/polygon has more vertices, ",(0,r.jsx)(n.code,{children:"enter"}),' is called to backfill the "from" value. In this case, ',(0,r.jsx)(n.code,{children:"enter"})," also receives a second argument ",(0,r.jsx)(n.code,{children:"fromChunk"}),' representing the "from" value of the entire geometry.']}),"\n",(0,r.jsxs)(n.p,{children:["The process of attribute backfilling may be expensive performance-wise because it calls ",(0,r.jsx)(n.code,{children:"enter"})," for each index on the CPU, then upload the new data to the GPU. It only happens when data size/vertex count is growing."]}),"\n",(0,r.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(n.p,{children:["Between updates, objects are identified by their index in the ",(0,r.jsx)(n.code,{children:"data"})," array. This means that if objects are inserted or removed, the transition will not look as expected. There is ",(0,r.jsx)(n.a,{href:"https://github.com/visgl/deck.gl/issues/2570",children:"an open feature request"})," for supporting custom object id."]}),"\n",(0,r.jsx)(n.h2,{id:"custom-animations",children:"Custom Animations"}),"\n",(0,r.jsx)(n.p,{children:"The most powerful way to create animations with deck.gl is to manage data and settings externally, and update the layers' props on every frame."}),"\n",(0,r.jsxs)(n.p,{children:["The following example shows the ",(0,r.jsx)(n.a,{href:"/docs/api-reference/geo-layers/trips-layer",children:"TripsLayer"}),"'s ",(0,r.jsx)(n.code,{children:"currentTime"})," prop animated by the ",(0,r.jsx)(n.a,{href:"https://popmotion.io/",children:"popmotion"})," library:"]}),"\n",(0,r.jsxs)(s.A,{groupId:"language",children:[(0,r.jsx)(o.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import {Deck} from '@deck.gl/core';\nimport {TripsLayer} from '@deck.gl/geo-layers';\nimport {animate} from \"popmotion\";\n\nconst currentTimeAnimation = animate({\n  from: 0, // currentTime min value\n  to: 1800, // currentTime max value\n  duration: 5000, // over the course of 5 seconds\n  repeat: Infinity,\n  onUpdate: updateLayers\n});\n\nconst deckInstance = new Deck({\n  initialViewState: {\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 12\n  },\n  controller: true\n});\n\nfunction updateLayers(currentTime) {\n  const layers = [\n    new TripsLayer({\n      id: 'TripsLayer',\n      data: '/path/to/data.json',\n      getPath: d => d.waypoints.map(p => p.coordinates),\n      getTimestamps: d => d.waypoints.map(p => p.timestamp),\n      getColor: [253, 128, 93],\n      getWidth: 50,\n\n      currentTime,\n      trailLength: 600\n    })\n  ];\n\n  deckInstance.setProps({layers});\n}\n"})})}),(0,r.jsx)(o.A,{value:"ts",label:"TypeScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import {Deck} from '@deck.gl/core';\nimport {TripsLayer} from '@deck.gl/geo-layers';\nimport {animate} from \"popmotion\";\n\nconst currentTimeAnimation = animate<number>({\n  from: 0, // currentTime min value\n  to: 1800, // currentTime max value\n  duration: 5000, // over the course of 5 seconds\n  repeat: Infinity,\n  onUpdate: updateLayers\n});\n\nconst deckInstance = new Deck({\n  initialViewState: {\n    longitude: -122.4,\n    latitude: 37.8,\n    zoom: 12\n  },\n  controller: true\n});\n\ntype TripData = {\n  coordinates: [longitude: number, latitude: number][];\n  timestamps: number[];\n};\n\nfunction updateLayers(currentTime: number) {\n  const layers = [\n    new TripsLayer<TripData>({\n      id: 'TripsLayer',\n      data: '/path/to/data.json',\n      getPath: (d: TripData) => d.waypoints.map(p => p.coordinates),\n      getTimestamps: (d: TripData) => d.waypoints.map(p => p.timestamp),\n      getColor: [253, 128, 93],\n      getWidth: 50,\n\n      currentTime,\n      trailLength: 600\n    })\n  ];\n\n  deckInstance.setProps({layers});\n}\n"})})}),(0,r.jsx)(o.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React, {useState, useEffect} from 'react';\nimport {DeckGL} from '@deck.gl/react';\nimport {MapViewState} from '@deck.gl/core';\nimport {TripsLayer} from '@deck.gl/geo-layers';\nimport {animate} from \"popmotion\";\n\nconst INITIAL_VIEW_STATE: MapViewState = {\n  longitude: -122.4,\n  latitude: 37.8,\n  zoom: 12\n};\n\ntype TripData = {\n  coordinates: [longitude: number, latitude: number][];\n  timestamps: number[];\n};\n\nfunction App() {\n  const [currentTime, setCurrentTime] = useState<number>(0);\n\n  useEffect(() => {\n    const currentTimeAnimation = animate<number>({\n      from: 0, // currentTime min value\n      to: 1800, // currentTime max value\n      duration: 5000, // over the course of 5 seconds\n      repeat: Infinity,\n      onUpdate: setCurrentTime\n    });\n    return () => currentTimeAnimation.stop();\n  });\n\n  const layers = [\n    new TripsLayer<TripData>({\n      id: 'TripsLayer',\n      data: '/path/to/data.json',\n      getPath: (d: TripData) => d.waypoints.map(p => p.coordinates),\n      getTimestamps: (d: TripData) => d.waypoints.map(p => p.timestamp),\n      getColor: [253, 128, 93],\n      getWidth: 50,\n\n      currentTime,\n      trailLength: 600\n    })\n  ];\n\n  return <DeckGL\n    initialViewState={INITIAL_VIEW_STATE}\n    controller\n    layers={layers}\n  />;\n}\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Deck.gl is designed to handle layer updates very efficiently at high frame rate. An example of this kind of application is ",(0,r.jsx)(n.a,{href:"https://avs.auto",children:"autonomous vehicle visualization"}),", where car pose, LIDAR point clouds, camera imagery, as well as geometries outlining perception, prediction and planning decisions are streamed in from a server many times a second. The ",(0,r.jsx)(n.a,{href:"/docs/developer-guide/performance",children:"performance guide"})," describes various techniques in optimizing for large datasets and frequent updates."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://hubble.gl/",children:"hubble.gl"}),", a project by the vis.gl community, implements comprehensive keyframe-controlled animation of deck.gl layers for interactive storytelling and/or render to video."]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var i=t(34164);const r={tabItem:"tabItem_Ymn6"};var a=t(74848);function s(e){let{children:n,hidden:t,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,s),hidden:t,children:n})}},11470:(e,n,t)=>{t.d(n,{A:()=>w});var i=t(96540),r=t(34164),a=t(23104),s=t(56347),o=t(205),l=t(57485),c=t(31682),d=t(70679);function h(e){var n,t;return null!=(n=null==(t=i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function u(e){const{values:n,children:t}=e;return(0,i.useMemo)((()=>{const e=null!=n?n:function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:i,default:r}}=e;return{value:n,label:t,attributes:i,default:r}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const r=(0,s.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l.aZ)(a),(0,i.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace(Object.assign({},r.location,{search:n.toString()}))}),[a,r])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=u(e),[s,l]=(0,i.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:i}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+i.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const r=null!=(n=i.find((e=>e.default)))?n:i[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[c,h]=m({queryString:t,groupId:r}),[x,j]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,a]=(0,d.Dv)(t);return[r,(0,i.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:r}),g=(()=>{const e=null!=c?c:x;return p({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{g&&l(g)}),[g]);return{selectedValue:s,selectValue:(0,i.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error("Can't select invalid tab value="+e);l(e),h(e),j(e)}),[h,j,a]),tabValues:a}}var j=t(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function b(e){let{className:n,block:t,selectedValue:i,selectValue:s,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),r=o[t].value;r!==i&&(c(n),s(r))},h=e=>{var n;let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{var i;const n=l.indexOf(e.currentTarget)+1;t=null!=(i=l[n])?i:l[0];break}case"ArrowLeft":{var r;const n=l.indexOf(e.currentTarget)-1;t=null!=(r=l[n])?r:l[l.length-1];break}}null==(n=t)||n.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,f.jsx)("li",Object.assign({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>l.push(e),onKeyDown:h,onClick:d},a,{className:(0,r.A)("tabs__item",g.tabItem,null==a?void 0:a.className,{"tabs__item--active":i===n}),children:null!=t?t:n}),n)}))})}function y(e){let{lazy:n,children:t,selectedValue:a}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function v(e){const n=x(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",g.tabList),children:[(0,f.jsx)(b,Object.assign({},n,e)),(0,f.jsx)(y,Object.assign({},n,e))]})}function w(e){const n=(0,j.A)();return(0,f.jsx)(v,Object.assign({},e,{children:h(e.children)}),String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);